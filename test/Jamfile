########### test apps #############
import os ;

local GENEVA = [ os.environ GENEVA ] ;
local ROOTSYS = [ os.environ ROOTSYS ] ;
local ROOTINC = [ os.environ ROOTINCLUDE ] ;
local BOOST_BUILD_PATH = [ os.environ BOOST_BUILD_PATH ] ;

local rlibs = [ SHELL "$ROOTSYS/bin/root-config --libs" ] ;
ROOTLIBS = [ MATCH "(.*)[\n]" : $(rlibs) ] ;

BOOSTLIBS = -lboost_date_time -lboost_filesystem -lboost_program_options -lboost_regex -lboost_serialization -lboost_system -lboost_thread-mt -lboost_test_exec_monitor -L$(BOOST_BUILD_PATH)/lib ;

local rlibs = [ SHELL "$ROOTSYS/bin/root-config --libs" ] ;
ROOTLIBS = [ MATCH "(.*)[\n]" : $(rlibs) ] ;

project :
	requirements <include>./
        <include>$(TOP)/Core
        <include>$(TOP)/OIFMinuit2
        <include>$(TOP)/OIFGeneva
        <include>$(TOP)/PIFBW
        <include>$(TOP)/DIFRoot2Part
        <include>$(TOP)/EIFMinLogLH
	<include>$(ROOTINC)
	<include>$(BOOST_BUILD_PATH)/include
	<cxxflags>-ftemplate-depth-256
	<cxxflags>-std=c++0x
	<linkflags>$(BOOSTLIBS)
	<linkflags>$(ROOTLIBS)
	<linkflags>-lgomp
	<linkflags>-lEG
	;

lib test : 
        [ glob *.cpp : *App.cpp ]
        : : ;
        
exe cx0testApp : 
        CX0TestApp.cpp 
        test
        : ;
        
exe parametertestApp : 
        ParameterTestApp.cpp 
        test
        $(TOP)/Core//ComPWA 
        : ;
        
exe dataiftestApp : 
        DataIFTestApp.cpp 
        test
        $(TOP)/Core//ComPWA
        $(TOP)/DIFRoot2Part//DIFRoot2Part  
        : ;

if $(GENEVA) { 
exe optimizertestApp : 
        OptimizerTestApp.cpp 
        test
        $(TOP)/Core//ComPWA
        $(TOP)/OIFMinuit2//OIFMinuit2
        $(TOP)/OIFGeneva//OIFGeneva   
        : ;
} else {
exe optimizertestApp : 
        MinuitTestApp.cpp 
        test
        $(TOP)/Core//ComPWA
        $(TOP)/OIFMinuit2//OIFMinuit2
        : ;
}

exe physicstestApp : 
        PhysicsTestApp.cpp 
        test
        $(TOP)/Core//ComPWA
        $(TOP)/PIFBW//PIFBW  
        : ;
        
exe estimatortestApp : 
        EstimatorTestApp.cpp 
        test
        $(TOP)/Core//ComPWA
        $(TOP)/EIFMinLogLH//EIFMinLogLH 
        $(TOP)/PIFBW//PIFBW  
        $(TOP)/DIFRoot2Part//DIFRoot2Part
        : ;
        
exe integrationtestApp : 
        IntegrationTestApp.cpp 
        test
        $(TOP)/Core//ComPWA
        $(TOP)/EIFMinLogLH//EIFMinLogLH 
        $(TOP)/PIFBW//PIFBW  
        $(TOP)/DIFRoot2Part//DIFRoot2Part
        $(TOP)/OIFMinuit2//OIFMinuit2
        : ;
        
exe runmanagertestApp : 
        RunManagerTestApp.cpp 
        test
        $(TOP)/Core//ComPWA
        $(TOP)/EIFMinLogLH//EIFMinLogLH 
        $(TOP)/PIFBW//PIFBW  
        $(TOP)/DIFRoot2Part//DIFRoot2Part
        $(TOP)/OIFMinuit2//OIFMinuit2
        : ;
        
exe gentwopartApp : 
        GenTwoPartApp.cpp 
        test
        $(TOP)/Core//ComPWA
        $(TOP)/PIFBW//PIFBW  
        : ;

install dist : test : <location>$(TOP)/lib <threading>single ;
install dist2 : parametertestApp cx0testApp dataiftestApp optimizertestApp physicstestApp : <location>$(TOP)/bin <threading>single ;
install dist3 : estimatortestApp integrationtestApp runmanagertestApp gentwopartApp : <location>$(TOP)/bin <threading>single ;

