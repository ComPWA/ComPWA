########### test apps #############
import os ;

local GENEVA = [ os.environ GENEVA ] ;
local ROOTSYS = [ os.environ ROOTSYS ] ;
local ROOTINC = [ os.environ ROOTINCLUDE ] ;
local BOOST_BUILD_PATH = [ os.environ BOOST_BUILD_PATH ] ;

local rlibs = [ SHELL "$ROOTSYS/bin/root-config --libs" ] ;
ROOTLIBS = [ MATCH "(.*)[\n]" : $(rlibs) ] ;

BOOSTLIBS = -lboost_date_time -lboost_filesystem -lboost_program_options -lboost_regex -lboost_serialization -lboost_system -lboost_thread-mt -lboost_test_exec_monitor -L$(BOOST_BUILD_PATH)/lib ;

local rlibs = [ SHELL "$ROOTSYS/bin/root-config --libs" ] ;
ROOTLIBS = [ MATCH "(.*)[\n]" : $(rlibs) ] ;

project :
	requirements <include>./
	    <include>$(TOP)
	<include>$(ROOTINC)
	<include>$(BOOST_BUILD_PATH)/include
	<linkflags>$(BOOSTLIBS)
	<linkflags>$(ROOTLIBS)
	<linkflags>-lgomp
	<linkflags>-lEG
	<linkflags>-lRooFit
	<linkflags>-lRooFitCore
	<linkflags>-L$(TOP)/external/qft++/lib
	<linkflags>-lqft++
	;

lib test : 
        [ glob *.cpp : *App.cpp ]
        : : ;
        
exe cx0testApp : 
        CX0TestApp.cpp 
        test
        : ;
        
exe dataiftestApp : 
        DataIFTestApp.cpp 
        test
        $(TOP)/Core//ComPWA
        $(TOP)/DataReader/RootReader//RootReader  
        : ;

if $(GENEVA) { 
exe optimizertestApp : 
        OptimizerTestApp.cpp 
        test
        $(TOP)/Core//ComPWA
        $(TOP)/Optimizer/Minuit2//Minuit2IF
        $(TOP)/Optimizer/Geneva//GenevaIF  
        : ;
} else {
exe optimizertestApp : 
        MinuitTestApp.cpp 
        test
        $(TOP)/Core//ComPWA
        $(TOP)/Optimizer/Minuit2//Minuit2IF
        : ;
}

exe physicstestApp : 
        PhysicsTestApp.cpp 
        test
        $(TOP)/Core//ComPWA
        $(TOP)/Physics/BreitWigner//BreitWigner  
        : ;
        
exe estimatortestApp : 
        EstimatorTestApp.cpp 
        test
        $(TOP)/Core//ComPWA
        $(TOP)/Estimator/MinLogLH//MinLogLH 
        $(TOP)/Estimator/ChiOneD//ChiOneD 
        $(TOP)/Physics/BreitWigner//BreitWigner  
        $(TOP)/DataReader/RootReader//RootReader
        : ;
        
exe integrationtestApp : 
        IntegrationTestApp.cpp 
        test
        $(TOP)/Core//ComPWA
        $(TOP)/Estimator/MinLogLH//MinLogLH 
        $(TOP)/Physics/BreitWigner//BreitWigner   
        $(TOP)/DataReader/RootReader//RootReader
        $(TOP)/Optimizer/Minuit2//Minuit2IF
        : ;
        
exe integrationtestbinnedApp : 
        IntegrationTestBinnedApp.cpp 
        test
        $(TOP)/Core//ComPWA
        $(TOP)/Estimator/ChiOneD//ChiOneD 
        $(TOP)/Physics/BreitWigner//BreitWigner   
        $(TOP)/DataReader/RootReader//RootReader
        $(TOP)/Optimizer/Minuit2//Minuit2IF
        : ;
        
exe runmanagertestApp : 
        RunManagerTestApp.cpp 
        test
        $(TOP)/Core//ComPWA
        $(TOP)/Estimator/MinLogLH//MinLogLH 
        $(TOP)/Physics/BreitWigner//BreitWigner   
        $(TOP)/DataReader/RootReader//RootReader
        $(TOP)/Optimizer/Minuit2//Minuit2IF
        : ;
        
exe gentwopartApp : 
        GenTwoPartApp.cpp 
        test
        $(TOP)/Core//ComPWA
        $(TOP)/Physics/BreitWigner//BreitWigner  
        : ;
        
exe gendalitzApp : 
        GenDalitzApp.cpp 
        test
        $(TOP)/Core//ComPWA
        $(TOP)/Physics/AmplitudeSum//AmplitudeSum  
        : ;
        
exe dalitzplotApp : 
        DalitzDataPlotterApp.cpp 
        test
        $(TOP)/Core//ComPWA
        $(TOP)/DataReader/RootReader//RootReader  
        : ;
        
exe dalitzfitApp : 
        DalitzFitApp.cpp 
        test
        $(TOP)/Core//ComPWA
        $(TOP)/Physics/AmplitudeSum//AmplitudeSum  
        $(TOP)/DataReader/RootReader//RootReader
        $(TOP)/Estimator/MinLogLH//MinLogLH 
        $(TOP)/Optimizer/Minuit2//Minuit2IF
        : ;

install dist : test : <location>$(TOP)/lib <threading>single ;
install dist2 : dalitzfitApp cx0testApp dataiftestApp optimizertestApp physicstestApp : <location>$(TOP)/bin <threading>single ;
install dist3 : estimatortestApp integrationtestApp integrationtestbinnedApp runmanagertestApp gentwopartApp gendalitzApp dalitzplotApp : <location>$(TOP)/bin <threading>single ;

